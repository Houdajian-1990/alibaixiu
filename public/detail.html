<script>
    function getUrlparams(name) {
        var paramsAry = location.search.substr(1).split('&');
        // console.log(paramsAry);
        for (var i = 0; i < paramsAry.length; i++) {
            var tmp = paramsAry[i].split('=');
            if (tmp[0] == name) {
                return paramsAry[i].split('=')[1];
            }
        }
        return -1
    }
    var categoryId = getUrlparams('categoryId')
        // console.log(categoryId);
    if (categoryId == -1) {
        location.href = 'index.html'
    }
</script>
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>阿里百秀-发现生活，发现美!</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/vendors/font-awesome/css/font-awesome.css">
</head>

<body>
    <div class="topnav">
        <ul id="topnavs">


        </ul>
    </div>
    <div class="header">
        <h1 class="logo">
            <a href="index.html"><img src="assets/img/logo.png" alt=""></a>
        </h1>
        <ul class="nav" id="navs">

        </ul>
        <div class="search">
            <form>
                <input type="text" class="keys" placeholder="输入关键字">
                <input type="submit" class="btn" value="搜索">
            </form>
        </div>
    </div>
    <div class="aside">
        <div class="widgets">
            <h4>搜索</h4>
            <div class="body search">
                <form>
                    <input type="text" class="keys" placeholder="输入关键字">
                    <input type="submit" class="btn" value="搜索">
                </form>
            </div>
        </div>
        <div class="widgets">
            <h4>随机推荐</h4>
            <ul class="body random" id="random">
                <!-- <li>
                            <a href="javascript:;">
                                <p class="title">废灯泡的14种玩法 妹子见了都会心动</p>
                                <p class="reading">阅读(819)</p>
                                <div class="pic">
                                    <img src="uploads/widget_1.jpg" alt="">
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <p class="title">可爱卡通造型 iPhone 6防水手机套</p>
                                <p class="reading">阅读(819)</p>
                                <div class="pic">
                                    <img src="uploads/widget_2.jpg" alt="">
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <p class="title">变废为宝！将手机旧电池变为充电宝的Better</p>
                                <p class="reading">阅读(819)</p>
                                <div class="pic">
                                    <img src="uploads/widget_3.jpg" alt="">
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <p class="title">老外偷拍桂林芦笛岩洞 美如“地下彩虹”</p>
                                <p class="reading">阅读(819)</p>
                                <div class="pic">
                                    <img src="uploads/widget_4.jpg" alt="">
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <p class="title">doge神烦狗打底南瓜裤 就是如此魔性</p>
                                <p class="reading">阅读(819)</p>
                                <div class="pic">
                                    <img src="uploads/widget_5.jpg" alt="">
                                </div>
                            </a>
                        </li> -->
            </ul>
        </div>
        <div class="widgets">
            <h4>最新评论</h4>
            <ul class="body discuz" id="discuz">
                <!-- <li>
                            <a href="javascript:;">
                                <div class="avatar">
                                    <img src="uploads/avatar_1.jpg" alt="">
                                </div>
                                <div class="txt">
                                    <p>
                                        <span>鲜活</span>2020-02-01说:
                                    </p>
                                    <p>挺会玩的</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <div class="avatar">
                                    <img src="uploads/avatar_1.jpg" alt="">
                                </div>
                                <div class="txt">
                                    <p>
                                        <span>鲜活</span>2020-02-01说:
                                    </p>
                                    <p>挺会玩的</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <div class="avatar">
                                    <img src="uploads/avatar_2.jpg" alt="">
                                </div>
                                <div class="txt">
                                    <p>
                                        <span>鲜活</span>2020-02-01说:
                                    </p>
                                    <p>挺会玩的</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <div class="avatar">
                                    <img src="uploads/avatar_1.jpg" alt="">
                                </div>
                                <div class="txt">
                                    <p>
                                        <span>鲜活</span>2020-02-01说:
                                    </p>
                                    <p>挺会玩的</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <div class="avatar">
                                    <img src="uploads/avatar_2.jpg" alt="">
                                </div>
                                <div class="txt">
                                    <p>
                                        <span>鲜活</span>2020-02-01说:
                                    </p>
                                    <p>挺会玩的</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <div class="avatar">
                                    <img src="uploads/avatar_1.jpg" alt="">
                                </div>
                                <div class="txt">
                                    <p>
                                        <span>鲜活</span>2020-02-01说:
                                    </p>
                                    <p>挺会玩的</p>
                                </div>
                            </a>
                        </li> -->
            </ul>
        </div>
    </div>
    <div class="content">
        <div class="swipe">
            <ul class="swipe-wrapper" id="indexLi">
                <!--  <li>
                            <a href="#">
                                <img src="uploads/slide_1.jpg">
                                <span>XIU主题演示</span>
                            </a>
                        </li> 
                        <li>
                            <a href="#">
                                <img src="uploads/slide_2.jpg">
                                <span>XIU主题演示</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <img src="uploads/slide_1.jpg">
                                <span>XIU主题演示</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <img src="uploads/slide_2.jpg">
                                <span>XIU主题演示</span>
                            </a>
                        </li> -->
            </ul>
            <p class="cursor"><span class="active"></span><span></span><span></span><span></span><span></span></p>
            <a href="javascript:;" class="arrow prev"><i class="fa fa-chevron-left"></i></a>
            <a href="javascript:;" class="arrow next"><i class="fa fa-chevron-right"></i></a>
        </div>

        <div class="panel new" id="news">



        </div>
        <div class="panel hots">
            <h3>热门推荐</h3>
            <ul id="rec">
                <!-- <li>
                                <a href="javascript:;">
                                    <img src="uploads/hots_2.jpg" alt="">
                                    <span>星球大战:原力觉醒视频演示 电影票68</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:;">
                                    <img src="uploads/hots_3.jpg" alt="">
                                    <span>你敢骑吗？全球第一辆全功能3D打印摩托车亮相</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:;">
                                    <img src="uploads/hots_4.jpg" alt="">
                                    <span>又现酒窝夹笔盖新技能 城里人是不让人活了！</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:;">
                                    <img src="uploads/hots_5.jpg" alt="">
                                    <span>实在太邪恶！照亮妹纸绝对领域与私处</span>
                                </a>
                            </li> -->
            </ul>
        </div>
    </div>
    <div class="footer">
        <p>© 2016 XIU主题演示 本站主题由 themebetter 提供</p>
    </div>
</body>
<script src="assets/vendors/jquery/jquery.min.js"></script>
<script src="./assets/vendors/art-template/template-web.js"></script>
<script src="./assets/js/recommend.js"></script>
<script type="text/html" id="indexTpl">
    {{each list}}
    <li>
        <a href="{{$value.link}}">
            <img src="{{$value.image}}">
            <span>{{$value.title}}</span>
        </a>
    </li>
    {{/each}}
</script>
<script type="text/html" id="newTpl">
    <!-- <p>{{category.title}} > {{title}}</p> -->
    <a href="list.html?categoryId={{category._id}}">{{category.title}} </a> > {{title}}
    <div class="entry">
        <div class="head">
            <span class="sort">{{category.title}}</span>
            <a href="javascript:;">{{title}}</a>
        </div>
        <div class="main">
            <p class="info">{{author.nickName}} 发表于 {{createAt.substr(0,10)}}</p>
            <p class="brief">{{content}}</p>
            <p class="extra">
                <span class="reading">阅读({{meta.comments}})</span>
                <span class="comment">评论({{meta.views}})</span>
                <a href="javascript:;" class="like">
                    <i class="fa fa-thumbs-up"></i>
                    <span class="zhang">赞({{meta.likes}})</span>
                </a>
                <a href="javascript:;" class="tags">
  分类：<a href="list.html?categoryId={{category._id}}">{{category.title}}</a>
                </a>
            </p>
            <a href="detail.html?categoryId={{_id}}" class="thumb">
                <img src="{{thumbnail}}" alt="">
            </a>
        </div>
    </div>
</script>

<script type="text/html" id="randomTpl">
    {{each list}}
    <li>
        <a href="detail.html?categoryId={{$value._id}}">
            <p class="title">{{$value.title}}</p>
            <p class="reading">阅读({{$value.meta.comments}})</p>
            <div class="pic">
                <img src="{{$value.thumbnail}}" alt="">
            </div>
        </a>
    </li>
    {{/each}}
</script>

<script type="text/html" id="discuzTpl">
    {{each list}}
    <li>
        <a href="javascript:;">
            <div class="avatar">
                <img src="{{$value.author.avatar}}" alt="">
            </div>
            <div class="txt">
                <p>
                    <span>{{$value.author.nickName}}</span>{{$value.createAt.substr(0,10)}}说:
                </p>
                <p>{{$value.content}}</p>
            </div>
        </a>
    </li>
    {{/each}}
</script>
<script>
    //获取随机推荐
    $.ajax({
            type: 'get',
            url: '/posts/random',
            success: function(res) {
                // console.log(res);
                var str1s = template('randomTpl', {
                    list: res
                })
                $('#random').html(str1s)
            }
        })
        //获取最新评论
    $.ajax({
            type: 'get',
            url: '/comments/lasted',
            success: function(res) {
                // console.log(res);
                var str2s = template('discuzTpl', {
                    list: res
                })
                $('#discuz').append(str2s)
            }
        })
        //根据ID获取文章
    $.ajax({
            type: 'get',
            url: '/posts/' + categoryId,
            success: function(res) {
                // console.log(res);
                var strs = template('newTpl', res)
                $('#news').html(strs)
            }
        })
        //点赞时
    $('#news').on('click', '.zhang', function() {
        // alert(categoryId)
        $.ajax({
            type: 'post',
            url: '/posts/fabulous/' + categoryId,
            success: function() {
                alert('感谢老铁点赞，爱你呦！');
                location.reload()
            }
        })
    })

    //获取网站的配置信息
    $.ajax({
        type: 'get',
        url: '/settings',
        success: function(res) {
            console.log(res);

        }
    })
</script>

</html>